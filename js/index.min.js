/*
data.coffee
Copyright (C) 2013 ender xu <xuender@gmail.com>

Distributed under terms of the MIT license.
*/

var CHECK, END, INPUT, PAGE, SELECT, START;

START = 0;

END = 1;

SELECT = 2;

INPUT = 3;

CHECK = 4;

PAGE = [
  {
    type: START
  }, {
    type: SELECT,
    title: '对谁进行测试？',
    p: '由于“医不自医”自己无法看清自己的原因，你需要选择',
    items: ['自己', '亲友']
  }, {
    type: INPUT,
    title: '请输入被测试人的称呼',
    p: '测试结果上显示的称呼'
  }, {
    type: CHECK,
    title: "的面部特征有那些？",
    p: '查看以下面部特征，选择合适的，可多选',
    items: [
      {
        l: '长瘦',
        v: '木'
      }, {
        l: '露骨',
        v: '木'
      }, {
        l: '上宽下窄',
        v: '木'
      }, {
        l: '上尖中宽',
        v: '火'
      }, {
        l: '面丰满',
        v: '火'
      }, {
        l: '面丰厚',
        v: '土'
      }, {
        l: '方脸',
        v: '土'
      }, {
        l: '唇厚',
        v: '土'
      }, {
        l: '面长方',
        v: '金'
      }, {
        l: '颧稍高',
        v: '金'
      }, {
        l: '唇薄齿利',
        v: '金'
      }, {
        l: '眉清目秀',
        v: '金'
      }, {
        l: '面形肥',
        v: '水'
      }, {
        l: '面漫团',
        v: '水'
      }, {
        l: '面下稍宽',
        v: '水'
      }, {
        l: '眉粗',
        v: '水'
      }, {
        l: '目大',
        v: '水'
      }
    ]
  }, {
    type: CHECK,
    title: "发怒时面色是什么样的？",
    p: '看以下特征，选择合适的，可多选',
    items: [
      {
        l: '面带凶气',
        v: '木'
      }, {
        l: '面色发青',
        v: '木'
      }, {
        l: '面红耳赤',
        v: '火'
      }, {
        l: '面色发黄',
        v: '土'
      }, {
        l: '面色苍白',
        v: '金'
      }, {
        l: '面色发暗',
        v: '水'
      }, {
        l: '面色发黑',
        v: '水'
      }
    ]
  }, {
    type: CHECK,
    title: "的体型及行动表现有那些？",
    p: '查看以下身体特征，选择合适的，可多选',
    items: [
      {
        l: '身材细高',
        v: '木'
      }, {
        l: '肩背耸直',
        v: '木'
      }, {
        l: '背隆腰厚',
        v: '土'
      }, {
        l: '身段苗条',
        v: '金'
      }, {
        l: '气度轩昂',
        v: '木'
      }, {
        l: '走路摇摆',
        v: '火'
      }, {
        l: '行动急速',
        v: '火'
      }, {
        l: '气度岸然',
        v: '火'
      }, {
        l: '行动稳重',
        v: '土'
      }, {
        l: '举止轻灵',
        v: '金'
      }, {
        l: '气度活泼',
        v: '金'
      }, {
        l: '行动迟缓',
        v: '水'
      }, {
        l: '脚步高压有声',
        v: '木'
      }
    ]
  }, {
    type: CHECK,
    title: "说话特点有那些？",
    p: '查看以下语言特征，选择合适的，多选',
    items: [
      {
        l: '语音直而短',
        v: '木'
      }, {
        l: '齿音重',
        v: '木'
      }, {
        l: '说话声音尖多破',
        v: '火'
      }, {
        l: '舌音重',
        v: '火'
      }, {
        l: '语音宽宏',
        v: '土'
      }, {
        l: '唇音重',
        v: '土'
      }, {
        l: '声音响亮',
        v: '金'
      }, {
        l: '语音慢而低',
        v: '水'
      }, {
        l: '喉音重',
        v: '水'
      }
    ]
  }, {
    type: END,
    title: '测试结果',
    p: '本测试结果仅供参考'
  }
];

/*
index.coffee
Copyright (C) 2013 ender xu <xuender@gmail.com>

Distributed under terms of the MIT license.
*/

var FiveCtrl;

angular.module('five', ['ui.bootstrap']);

FiveCtrl = function(scope, log) {
  scope.START = START;
  scope.END = END;
  scope.SELECT = SELECT;
  scope.INPUT = INPUT;
  scope.CHECK = CHECK;
  scope.name = '';
  scope.page = PAGE;
  scope.num = 0;
  scope.error = false;
  scope.$watch('num', function(n, o) {
    scope.p = scope.page[n];
    if (scope.p.type === END) {
      return scope.count();
    }
  });
  scope.next = function() {
    scope.error = false;
    if (scope.p.type === SELECT && !scope.p.value) {
      scope.error = true;
      return;
    } else if (scope.p.type === INPUT && !scope.f_name.$valid) {
      scope.error = true;
      $('#i_name').focus();
      return;
    }
    return scope.num += 1;
  };
  scope.prev = function() {
    return scope.num -= 1;
  };
  return scope.count = function() {
    var chartConfig, i, p, report, _i, _j, _len, _len1, _ref, _ref1;
    report = {
      '木': 0,
      '火': 0,
      '土': 0,
      '金': 0,
      '水': 0
    };
    _ref = scope.page;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      p = _ref[_i];
      if (p.type === CHECK) {
        _ref1 = p.items;
        for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
          i = _ref1[_j];
          if (i['s']) {
            report[i.v] += 1;
          }
        }
      }
    }
    chartConfig = {
      chart: {
        polar: true
      },
      title: {
        text: "" + scope.name + "的五行"
      },
      pane: {
        startAngle: 0,
        endAngle: 360
      },
      xAxis: {
        tickInterval: 72,
        min: 0,
        max: 360,
        labels: {
          formatter: function() {
            return {
              0: '木',
              72: '火',
              144: '土',
              216: '金',
              288: '水'
            }[this.value];
          }
        }
      },
      tooltip: {
        formatter: function() {
          return "" + scope.name + "的" + {
            0: '木',
            72: '火',
            144: '土',
            216: '金',
            288: '水'
          }[this.x] + "性得分<br/><b>" + this.y + "</b>";
        }
      },
      plotOptions: {
        series: {
          pointStart: 0,
          pointInterval: 72
        }
      },
      legend: {
        enabled: false
      },
      lang: {
        printChart: '打印测试结果',
        downloadPNG: '下载PNG图片',
        downloadJPEG: '下载JPEG图片',
        downloadPDF: '下载PDF文档',
        downloadSVG: '下载SVG矢量图片',
        contextButtonTitle: '测试结果输出'
      },
      series: [
        {
          type: 'area',
          name: scope.name,
          data: [report['木'], report['火'], report['土'], report['金'], report['水']]
        }
      ]
    };
    $('#container').highcharts(chartConfig);
    return $("tspan:contains('Highcharts.com')").remove();
  };
};

FiveCtrl.$inject = ['$scope', '$log'];
